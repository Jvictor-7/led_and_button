\doxysection{src/button.c File Reference}
\hypertarget{button_8c}{}\label{button_8c}\index{src/button.c@{src/button.c}}
{\ttfamily \#include "{}button.\+h"{}}\newline
{\ttfamily \#include $<$zephyr/kernel.\+h$>$}\newline
{\ttfamily \#include $<$zephyr/device.\+h$>$}\newline
{\ttfamily \#include $<$zephyr/drivers/gpio.\+h$>$}\newline
{\ttfamily \#include $<$zephyr/sys/util.\+h$>$}\newline
{\ttfamily \#include $<$zephyr/sys/printk.\+h$>$}\newline
{\ttfamily \#include $<$inttypes.\+h$>$}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{button_8c_a840217aee9bd887463dad1b56defb051}{SLEEP\+\_\+\+TIME\+\_\+\+MS}}~1
\begin{DoxyCompactList}\small\item\em Tempo de espera (em milissegundos) usado para sleep, se necessário. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{button_8c_aea6f782003374f75cd7ff90a9984658a}{SW0\+\_\+\+NODE}}~DT\+\_\+\+ALIAS(sw0)
\begin{DoxyCompactList}\small\item\em Node do botão definido pelo alias {\ttfamily sw0} no Devicetree. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{button_8c_ac9b522e4a4544cf42e8a3b37c1376f11}{ZBUS\+\_\+\+CHAN\+\_\+\+DEFINE}} (chan\+\_\+button\+\_\+evt, struct \mbox{\hyperlink{structmsg__button__evt}{msg\+\_\+button\+\_\+evt}}, NULL, NULL, ZBUS\+\_\+\+OBSERVERS\+\_\+\+EMPTY, ZBUS\+\_\+\+MSG\+\_\+\+INIT(.evt=\mbox{\hyperlink{button_8h_a87b4d74f8f15adabcc6ea07f1ee8aa6aad6bf33767d934ccc472ece469cb40e3d}{BUTTON\+\_\+\+EVT\+\_\+\+UNDEFINED}}))
\begin{DoxyCompactList}\small\item\em Canal ZBus para eventos do botão. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{button_8c_aced4b63040998ec6ba93edf16853e366}{timer\+\_\+button\+\_\+cb}} (struct k\+\_\+timer \texorpdfstring{$\ast$}{*}timer\+\_\+id)
\begin{DoxyCompactList}\small\item\em Callback do timer responsável por detectar long press. \end{DoxyCompactList}\item 
\mbox{\hyperlink{button_8c_a36615353063eec4e3a0490a6e93205db}{K\+\_\+\+TIMER\+\_\+\+DEFINE}} (timer\+\_\+button, \mbox{\hyperlink{button_8c_aced4b63040998ec6ba93edf16853e366}{timer\+\_\+button\+\_\+cb}}, NULL)
\begin{DoxyCompactList}\small\item\em Define o timer que será usado para detectar long press. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{button_8c_ab4b2c1747e66383dfb0b5679887e1854}{button\+\_\+pressed}} (const struct device \texorpdfstring{$\ast$}{*}dev, struct gpio\+\_\+callback \texorpdfstring{$\ast$}{*}cb, uint32\+\_\+t pins)
\begin{DoxyCompactList}\small\item\em Callback de interrupção do botão. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{button_8c_a596c0e0ecccb0aaa1f16a066e2d74479}{button\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Inicializa o botão a partir da especificação do Devicetree. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{button_8c_aca05b0a9cdeb7f84556f1c3b37e68d88}{button\+\_\+enable\+\_\+interrupts}} (void)
\begin{DoxyCompactList}\small\item\em Ativa as interrupções para o botão. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const struct gpio\+\_\+dt\+\_\+spec \mbox{\hyperlink{button_8c_aff7d1f2eb6cf27f396bf2400f02c238b}{button}} = GPIO\+\_\+\+DT\+\_\+\+SPEC\+\_\+\+GET(\mbox{\hyperlink{button_8c_aea6f782003374f75cd7ff90a9984658a}{SW0\+\_\+\+NODE}}, gpios)
\begin{DoxyCompactList}\small\item\em Especificação do botão obtida via Devicetree. \end{DoxyCompactList}\item 
static struct gpio\+\_\+callback \mbox{\hyperlink{button_8c_af87c152961b80d006d89268229eccd00}{button\+\_\+cb\+\_\+data}}
\begin{DoxyCompactList}\small\item\em Estrutura de callback associada ao botão. \end{DoxyCompactList}\item 
static bool \mbox{\hyperlink{button_8c_a40ddb0144823575f56937099a18a1510}{longpress\+\_\+detected}} = false
\begin{DoxyCompactList}\small\item\em Flag global que indica se ocorreu long press. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{button_8c_a840217aee9bd887463dad1b56defb051}\index{button.c@{button.c}!SLEEP\_TIME\_MS@{SLEEP\_TIME\_MS}}
\index{SLEEP\_TIME\_MS@{SLEEP\_TIME\_MS}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{SLEEP\_TIME\_MS}{SLEEP\_TIME\_MS}}
{\footnotesize\ttfamily \label{button_8c_a840217aee9bd887463dad1b56defb051} 
\#define SLEEP\+\_\+\+TIME\+\_\+\+MS~1}



Tempo de espera (em milissegundos) usado para sleep, se necessário. 

\Hypertarget{button_8c_aea6f782003374f75cd7ff90a9984658a}\index{button.c@{button.c}!SW0\_NODE@{SW0\_NODE}}
\index{SW0\_NODE@{SW0\_NODE}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{SW0\_NODE}{SW0\_NODE}}
{\footnotesize\ttfamily \label{button_8c_aea6f782003374f75cd7ff90a9984658a} 
\#define SW0\+\_\+\+NODE~DT\+\_\+\+ALIAS(sw0)}



Node do botão definido pelo alias {\ttfamily sw0} no Devicetree. 



\doxysubsection{Function Documentation}
\Hypertarget{button_8c_aca05b0a9cdeb7f84556f1c3b37e68d88}\index{button.c@{button.c}!button\_enable\_interrupts@{button\_enable\_interrupts}}
\index{button\_enable\_interrupts@{button\_enable\_interrupts}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{button\_enable\_interrupts()}{button\_enable\_interrupts()}}
{\footnotesize\ttfamily \label{button_8c_aca05b0a9cdeb7f84556f1c3b37e68d88} 
int button\+\_\+enable\+\_\+interrupts (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Ativa as interrupções para o botão. 

Ativa as interrupções do botão.

Configura interrupções nas bordas de subida e descida do sinal do botão. Adiciona o callback de interrupção para detecção de pressionamento/liberação.


\begin{DoxyRetVals}{Return values}
{\em 0} & Sucesso. \\
\hline
{\em $<$0} & Código de erro em caso de falha na configuração. \\
\hline
\end{DoxyRetVals}
\Hypertarget{button_8c_a596c0e0ecccb0aaa1f16a066e2d74479}\index{button.c@{button.c}!button\_init@{button\_init}}
\index{button\_init@{button\_init}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{button\_init()}{button\_init()}}
{\footnotesize\ttfamily \label{button_8c_a596c0e0ecccb0aaa1f16a066e2d74479} 
int button\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Inicializa o botão a partir da especificação do Devicetree. 

Inicializa o botão.

Configura o pino do botão como entrada GPIO.


\begin{DoxyRetVals}{Return values}
{\em 0} & Sucesso. \\
\hline
{\em -\/\+ENODEV} & Se o dispositivo do botão não estiver pronto. \\
\hline
{\em $<$0} & Código de erro da configuração do pino GPIO. \\
\hline
\end{DoxyRetVals}
\Hypertarget{button_8c_ab4b2c1747e66383dfb0b5679887e1854}\index{button.c@{button.c}!button\_pressed@{button\_pressed}}
\index{button\_pressed@{button\_pressed}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{button\_pressed()}{button\_pressed()}}
{\footnotesize\ttfamily \label{button_8c_ab4b2c1747e66383dfb0b5679887e1854} 
void button\+\_\+pressed (\begin{DoxyParamCaption}\item[{const struct device \texorpdfstring{$\ast$}{*}}]{dev}{, }\item[{struct gpio\+\_\+callback \texorpdfstring{$\ast$}{*}}]{cb}{, }\item[{uint32\+\_\+t}]{pins}{}\end{DoxyParamCaption})}



Callback de interrupção do botão. 

Essa função é chamada automaticamente quando o botão de estado\+: pressionado ou liberado. Quando pressionado, inicia um timer de 3 segundos. Se liberrado cancela o timer e envia os eventos. correspondentes via ZBus. Se o botão ficou pressionado por mais de 3 segundos, também envia o evento BUTTON\+\_\+\+EVT\+\_\+\+LONGPRESS após o evento BUTTON\+\_\+\+EVT\+\_\+\+RELEASED.


\begin{DoxyParams}{Parameters}
{\em dev} & Ponteiro para o dispositivo do GPIO. \\
\hline
{\em cb} & Ponteiro para a estrutura de callback do GPIO. \\
\hline
{\em pins} & Máscara de pinos que geraram a interrupção. \\
\hline
\end{DoxyParams}
\Hypertarget{button_8c_a36615353063eec4e3a0490a6e93205db}\index{button.c@{button.c}!K\_TIMER\_DEFINE@{K\_TIMER\_DEFINE}}
\index{K\_TIMER\_DEFINE@{K\_TIMER\_DEFINE}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{K\_TIMER\_DEFINE()}{K\_TIMER\_DEFINE()}}
{\footnotesize\ttfamily \label{button_8c_a36615353063eec4e3a0490a6e93205db} 
K\+\_\+\+TIMER\+\_\+\+DEFINE (\begin{DoxyParamCaption}\item[{timer\+\_\+button}]{}{, }\item[{\mbox{\hyperlink{button_8c_aced4b63040998ec6ba93edf16853e366}{timer\+\_\+button\+\_\+cb}}}]{}{, }\item[{NULL}]{}{}\end{DoxyParamCaption})}



Define o timer que será usado para detectar long press. 

\Hypertarget{button_8c_aced4b63040998ec6ba93edf16853e366}\index{button.c@{button.c}!timer\_button\_cb@{timer\_button\_cb}}
\index{timer\_button\_cb@{timer\_button\_cb}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{timer\_button\_cb()}{timer\_button\_cb()}}
{\footnotesize\ttfamily \label{button_8c_aced4b63040998ec6ba93edf16853e366} 
void timer\+\_\+button\+\_\+cb (\begin{DoxyParamCaption}\item[{struct k\+\_\+timer \texorpdfstring{$\ast$}{*}}]{timer\+\_\+id}{}\end{DoxyParamCaption})}



Callback do timer responsável por detectar long press. 

Essa função é chamada automaticamente após 3 segundos se o botão continuar pressionado. Ela apenas marca a flag {\ttfamily longpress\+\_\+detected} como true.


\begin{DoxyParams}{Parameters}
{\em timer\+\_\+id} & Ponteiro para o timer que disparou (não utilizado). \\
\hline
\end{DoxyParams}
\Hypertarget{button_8c_ac9b522e4a4544cf42e8a3b37c1376f11}\index{button.c@{button.c}!ZBUS\_CHAN\_DEFINE@{ZBUS\_CHAN\_DEFINE}}
\index{ZBUS\_CHAN\_DEFINE@{ZBUS\_CHAN\_DEFINE}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{ZBUS\_CHAN\_DEFINE()}{ZBUS\_CHAN\_DEFINE()}}
{\footnotesize\ttfamily \label{button_8c_ac9b522e4a4544cf42e8a3b37c1376f11} 
ZBUS\+\_\+\+CHAN\+\_\+\+DEFINE (\begin{DoxyParamCaption}\item[{chan\+\_\+button\+\_\+evt}]{}{, }\item[{struct \mbox{\hyperlink{structmsg__button__evt}{msg\+\_\+button\+\_\+evt}}}]{}{, }\item[{NULL}]{}{, }\item[{NULL}]{}{, }\item[{ZBUS\+\_\+\+OBSERVERS\+\_\+\+EMPTY}]{}{, }\item[{ZBUS\+\_\+\+MSG\+\_\+\+INIT(.evt=\mbox{\hyperlink{button_8h_a87b4d74f8f15adabcc6ea07f1ee8aa6aad6bf33767d934ccc472ece469cb40e3d}{BUTTON\+\_\+\+EVT\+\_\+\+UNDEFINED}})}]{}{}\end{DoxyParamCaption})}



Canal ZBus para eventos do botão. 

Este canal é utilizado para publicar eventos do tipo {\ttfamily \doxylink{structmsg__button__evt}{msg\+\_\+button\+\_\+evt}} relacionados ao estado do botão físico, como pressionado, liberado ou long press. 

\doxysubsection{Variable Documentation}
\Hypertarget{button_8c_aff7d1f2eb6cf27f396bf2400f02c238b}\index{button.c@{button.c}!button@{button}}
\index{button@{button}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{button}{button}}
{\footnotesize\ttfamily \label{button_8c_aff7d1f2eb6cf27f396bf2400f02c238b} 
const struct gpio\+\_\+dt\+\_\+spec button = GPIO\+\_\+\+DT\+\_\+\+SPEC\+\_\+\+GET(\mbox{\hyperlink{button_8c_aea6f782003374f75cd7ff90a9984658a}{SW0\+\_\+\+NODE}}, gpios)\hspace{0.3cm}{\ttfamily [static]}}



Especificação do botão obtida via Devicetree. 

\Hypertarget{button_8c_af87c152961b80d006d89268229eccd00}\index{button.c@{button.c}!button\_cb\_data@{button\_cb\_data}}
\index{button\_cb\_data@{button\_cb\_data}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{button\_cb\_data}{button\_cb\_data}}
{\footnotesize\ttfamily \label{button_8c_af87c152961b80d006d89268229eccd00} 
struct gpio\+\_\+callback button\+\_\+cb\+\_\+data\hspace{0.3cm}{\ttfamily [static]}}



Estrutura de callback associada ao botão. 

\Hypertarget{button_8c_a40ddb0144823575f56937099a18a1510}\index{button.c@{button.c}!longpress\_detected@{longpress\_detected}}
\index{longpress\_detected@{longpress\_detected}!button.c@{button.c}}
\doxysubsubsection{\texorpdfstring{longpress\_detected}{longpress\_detected}}
{\footnotesize\ttfamily \label{button_8c_a40ddb0144823575f56937099a18a1510} 
bool longpress\+\_\+detected = false\hspace{0.3cm}{\ttfamily [static]}}



Flag global que indica se ocorreu long press. 

Essa flag é ativada pelo timer após 3 segundos de botão pressionado. É checada no momento de liberação do botão para emitir o evento BUTTON\+\_\+\+EVT\+\_\+\+LONGPRESS 